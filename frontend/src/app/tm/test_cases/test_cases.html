<app-navbar [showBackButton]="true" [backButtonText]="'Back to Projects'"
  [backButtonAction]="goBack.bind(this)"></app-navbar>

<div class="content">
  <div class="tabs-container">
    <div class="tabs">
      <button class="tab active">
        <i class="fa-solid fa-flask"></i>
        Test Cases
      </button>
      <button class="tab" (click)="navigateToTestCycles()">
        <i class="fa-regular fa-rectangle-list"></i>
        Test Cycles
      </button>
      <button class="create-btn-tab" (click)="createTestCase()">
        <i class="fa-solid fa-plus"></i>
      </button>
    </div>
  </div>

  <div class="tab-content">
    <div class="split-view">
      <!-- Folder Sidebar -->
      <div class="folder-sidebar">
        <div class="folder-header">
          <h3>Folders</h3>
        </div>
        <div class="folder-list">
          <div class="folder-item" [class.selected]="selectedFolder === null" (click)="selectFolder(null)">
            <i class="fa-solid fa-folder"></i>
            <span>Test Cases</span>
            <span class="folder-count">{{ testCases.length }}</span>
          </div>
          @for (folder of folders; track folder.name) {
          <div class="folder-item" [class.selected]="selectedFolder === folder.name"
            (click)="selectFolder(folder.name)">
            <i class="fa-solid fa-folder"></i>
            <span>{{ folder.name }}</span>
            <span class="folder-count">{{ folder.count }}</span>
            <button class="folder-delete-btn" (click)="$event.stopPropagation(); deleteFolder(folder.name)"
              title="Delete Folder">
              <i class="fa-solid fa-trash"></i>
            </button>
          </div>
          }
        </div>
      </div>

      <!-- Test Cases Content -->
      <div class="test-cases-content">
        @if (loading) {
        <div class="loading-container">
          <div class="spinner"></div>
        </div>
        } @else if (error) {
        <div class="error-state">
          <i class="fa-solid fa-triangle-exclamation"></i>
          <p>{{ error }}</p>
        </div>
        } @else if (filteredTestCases.length === 0) {
        <div class="empty-state">
          <i class="fa-solid fa-flask empty-state-icon"></i>
          <p>No test cases found</p>
          <p class="empty-state-message">Click the + button to create your first test case</p>
        </div>
        } @else {
        <div class="test-cases-list">
          <table>
            <thead>
              <tr>
                <th>Key</th>
                <th>Title</th>
                <th>Status</th>
                <th>Frequency</th>
                <th>Appliance</th>
                <th>Result</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              @for (testCase of testCases; track testCase._id) {
              <tr (click)="editTestCase(testCase)">
                <td>{{ testCase.test_case_key }}</td>
                <td>{{ testCase.title || 'Untitled' }}</td>
                <td>
                  <span class="status-badge" [attr.data-status]="testCase.status">
                    {{ testCase.status || 'N/A' }}
                  </span>
                </td>
                <td>{{ testCase.test_frequency || '-' }}</td>
                <td>{{ ((testCase.labels | slice:0) || []).sort().join(',') || '-' }}</td>
                <td>
                  <span class="result-badge" [attr.data-result]="testCase.last_result || 'NOT_EXECUTED'"
                    [attr.title]="testCase.last_result || 'Not Executed'">
                  </span>
                </td>
                <td>
                  <div class="action-buttons">
                    <button class="action-btn edit" (click)="$event.stopPropagation(); editTestCase(testCase)">
                      <i class="fa-solid fa-pen-to-square"></i>
                    </button>
                    <button class="action-btn delete" (click)="$event.stopPropagation(); deleteTestCase(testCase)">
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
        }
      </div>
    </div>
  </div>
</div>