<div class="test-executions-container">
    <div class="split-view">
        <div class="test-cases-panel">
            <div class="panel-header">
                <h4>Test Cases</h4>
                <span class="count-badge">{{ testCycle.executions?.length || 0 }}</span>
            </div>
            <div class="test-cases-list">
                @if (testCycle.executions && testCycle.executions.length > 0) {
                @for (execution of testCycle.executions; track execution.test_case_key) {
                <div class="test-case-item" [class.selected]="selectedExecution === execution"
                    [attr.data-status]="execution.result || 'NOT_EXECUTED'" (click)="selectExecution(execution)">
                    <div class="test-case-header">
                        <span class="test-case-key">{{ execution.test_case_key }}</span>
                    </div>
                    <div class="test-case-title">
                        @if (execution.title === undefined) {
                        -
                        } @else if (!execution.title) {
                        Untitled
                        } @else {
                        {{ execution.title }}
                        }
                    </div>
                </div>
                }
                } @else {
                <div class="empty-message">
                    <i class="fa-solid fa-flask"></i>
                    <p>No test cases added to this cycle</p>
                    <p class="hint">Click "Add Test Case" to get started</p>
                </div>
                }
            </div>
        </div>
        <div class="execution-details-panel">
            @if (selectedExecution) {
            <div class="details-header">
                <h4>
                    <a [attr.href]="'/test-cases/' + projectKey + '/test-case/' + (selectedExecution.test_case_key)"
                        target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none;">
                        {{ selectedExecution.test_case_key }}
                    </a>
                </h4>
                <div class="result-selector">
                    <select id="status-dropdown" [(ngModel)]="selectedExecution.result" name="status"
                        [ngClass]="'status-' + selectedExecution.result">
                        <option value="NOT_EXECUTED">NOT_EXECUTED</option>
                        <option value="PASS">PASS</option>
                        <option value="FAIL">FAIL</option>
                        <option value="BLOCKED">BLOCKED</option>
                    </select>
                </div>
            </div>
            <div class="details-content">
                <div class="details-section">
                    <label>Title: </label>
                    <p>{{ selectedExecution.title || 'N/A' }}</p>
                </div>
                <div class="details-section">
                    <label>Description: </label>
                    <p>{{ selectedExecution.description || 'N/A' }}</p>
                </div>
                <div class="details-section">
                    <label>Execution Key: </label>
                    @if (selectedExecution.execution_key) {
                    <p>
                        <a [attr.href]="'/test-cases/' + projectKey + '/executions/' + (selectedExecution.execution_key)"
                           target="_blank" rel="noopener noreferrer"
                           style="color: inherit; text-decoration: none;">
                            {{ selectedExecution.execution_key }}
                        </a>
                    </p>
                    } @else {
                    <p>N/A</p>
                    }
                </div>
                <div class="details-section">
                    <label>Execution Start: </label>
                    <p>{{ selectedExecution.started_at || 'N/A' }}</p>
                </div>
                <div class="details-section">
                    <label>Execution End: </label>
                    <p>{{ selectedExecution.finised_at || 'N/A' }}</p>
                </div>
                <div class="details-section">
                    <label>Custom Fields: </label>
                    <p>{{ selectedExecution.custom_fields || 'N/A' }}</p>
                </div>
                <div class="details-section">
                    <label>Comment: </label>
                    <textarea [(ngModel)]="selectedExecution.comment" name="comment"
                        placeholder="Add execution notes or comments..." rows="5">
                    </textarea>
                </div>
            </div>
            } @else {
            <div class="no-selection">
                <i class="fa-solid fa-hand-pointer"></i>
                <p>Select a test case to view details</p>
            </div>
            }
        </div>
    </div>
</div>