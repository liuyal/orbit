<nav class="navbar">
  <a class="navbar-brand" routerLink="/">
    <i class="fa-solid fa-rocket"></i>
    <span>ORBIT</span>
  </a>
</nav>

<div style="margin: 40px;">
  <div style="display: flex; gap: 10px; justify-content: flex-end;">
    <button class="prj-refresh-btn" (click)="refresh()">
      <i class="fa-solid fa-arrows-rotate"></i>
    </button>
    <button class="prj-create-btn" (click)="create()">
      <i class="fa-solid fa-plus"></i>
    </button>
  </div>

  @if (isLoading) {
    <div class="loading-container">
      <div class="spinner"></div>
      <span>Loading Projects...</span>
    </div>
  } @else if (projects.length === 0) {
    <div class="empty-state">
      <i class="fa-solid fa-folder-open"></i>
      <p>No projects found</p>
      <p style="font-size: 14px; margin-top: 10px;">Click the + button to create your first project</p>
    </div>
  } @else {
    <table class="prj-table">
      <thead>
        <tr>
          <th>PROJECT KEY</th>
          <th>DESCRIPTION</th>
          <th>STATUS</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        @for (item of projects; track item.project_key) {
          <tr>
            <td>
              <span class="project-key-link" (click)="navigateToTestCases(item.project_key)">
                {{ item.project_key }}
              </span>
            </td>
            <td>{{ item.description }}</td>
            <td>
              @if (item.is_active == true ) {
                <span class="status-badge active">
                  <i class="fa-solid fa-circle-check"></i>
                  Active
                </span>
              } @else {
                <span class="status-badge inactive">
                  <i class="fa-solid fa-circle-xmark"></i>
                  Inactive
                </span>
              }
            </td>
            <td>
              <div class="action-buttons">
                <button class="action-btn edit" (click)="editProject(item)">
                  <i class="fa-solid fa-pen-to-square"></i>
                  Edit
                </button>
                <button class="action-btn delete" (click)="deleteProject(item)">
                  <i class="fa-solid fa-trash"></i>
                  Delete
                </button>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
  }
</div>

<!-- Create Project Modal -->
@if (showCreateModal) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Create New Project</h2>
        <button class="close-btn" (click)="closeModal()">&times;</button>
      </div>
      <form (ngSubmit)="submitProject()">
        @if (apiError) {
          <div class="alert-error">
            {{ apiError }}
          </div>
        }
        <div class="form-group">
          <label for="project_key">Project Key *</label>
          <input
            type="text"
            id="project_key"
            [(ngModel)]="newProject.project_key"
            name="project_key"
            placeholder="Enter project key"
            required
            [class.error]="errors.project_key"
          />
          @if (errors.project_key) {
            <span class="error-message">{{ errors.project_key }}</span>
          }
        </div>
        <div class="form-group">
          <label for="description">Description</label>
          <textarea
            id="description"
            [(ngModel)]="newProject.description"
            name="description"
            placeholder="Enter project description"
            required
            [class.error]="errors.description"
          ></textarea>
          @if (errors.description) {
            <span class="error-message">{{ errors.description }}</span>
          }
        </div>
        <div class="form-group">
          <label>Status</label>
          <div class="toggle-wrapper">
            <label class="toggle-switch">
              <input
                type="checkbox"
                id="is_active"
                [(ngModel)]="newProject.is_active"
                name="is_active"
              />
              <span class="toggle-slider"></span>
            </label>
            <span class="toggle-label">{{ newProject.is_active ? 'Active' : 'Inactive' }}</span>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">
            Create
          </button>
        </div>
      </form>
    </div>
  </div>
}

<!-- Edit Project Modal -->
@if (showEditModal) {
  <div class="modal-overlay" (click)="closeEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Edit Project</h2>
        <button class="close-btn" (click)="closeEditModal()">&times;</button>
      </div>
      <form (ngSubmit)="submitEditProject()">
        @if (apiError) {
          <div class="alert-error">
            {{ apiError }}
          </div>
        }
        <div class="form-group">
          <label for="edit_project_key">Project Key *</label>
          <input
            type="text"
            id="edit_project_key"
            [(ngModel)]="editProjectData.project_key"
            name="edit_project_key"
            disabled
          />
        </div>
        <div class="form-group">
          <label for="edit_description">Description</label>
          <textarea
            id="edit_description"
            [(ngModel)]="editProjectData.description"
            name="edit_description"
            placeholder="Enter project description"
            required
            [class.error]="errors.description"
          ></textarea>
          @if (errors.description) {
            <span class="error-message">{{ errors.description }}</span>
          }
        </div>
        <div class="form-group">
          <label>Status</label>
          <div class="toggle-wrapper">
            <label class="toggle-switch">
              <input
                type="checkbox"
                id="edit_is_active"
                [(ngModel)]="editProjectData.is_active"
                name="edit_is_active"
              />
              <span class="toggle-slider"></span>
            </label>
            <span class="toggle-label">{{ editProjectData.is_active ? 'Active' : 'Inactive' }}</span>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closeEditModal()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">
            Update
          </button>
        </div>
      </form>
    </div>
  </div>
}
