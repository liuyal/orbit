# Dockerfile for Python backend with minimal Alpine base
FROM python:3.12-alpine

# Maintainer information
LABEL maintainer="jerry"

# Set working directory
WORKDIR /home

# Install only essential packages
RUN apk add --no-cache \
    supervisor \
    sqlite \
    sqlite-libs \
    bash

# Environment variables
ENV PYTHONPATH=/home/orbit
ENV MONGODB_HOST=mongodb-app
ENV SQLITE_DATABASE=/data/orbit.db

# Copy requirements file and install dependencies
COPY requirements.txt /tmp/requirements.txt
RUN pip install --no-cache-dir -r /tmp/requirements.txt

# Initialize a new SQLite database file if it doesn't exist
RUN mkdir -p /data

# Configure Supervisor to manage container services
COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf
CMD ["/usr/bin/supervisord", "-c", "/etc/supervisor/conf.d/supervisord.conf"]
